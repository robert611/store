{% extends 'base.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('assets/js/show_product.js') }}"></script>
{% endblock %}

{% block body %}
    <div class="container mt-5">
        <div class="card card-body no-border-radius">
            <div class="row pt-3">
                <div class="col-7 text-center">
                    <div id="carouselIndicators" class="carousel slide" data-ride="carousel" data-interval="false">
                        <ol class="carousel-indicators">
                            {% for i, picture in product.productPictures %}
                                <li data-target="#carouselExampleCaptions" data-slide-to="{{ i }}" {% if i == 0 %} class="active" {% endif %}></li>
                            {% endfor %}
                        </ol>
                        <div class="carousel-inner">
                            {% for i, picture in product.productPictures %}
                                <div class="carousel-item {% if i == 0 %} active {% endif %}">
                                    <img class="d-block w-100" src="{{ asset('uploads/pictures/'~picture.name) }}"/>
                                </div>
                            {% endfor %}
                        </div>
                        <a class="carousel-control-prev" href="#carouselIndicators" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselIndicators" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <div class="col-5">
                    <h5>{{ product.name }}</h5>
                    <small>od {{ product.owner.getUsername() }} - 99,4%</small>

                    <h3 class="mt-4 mb-4">{{ product.price }} zł</h3>

                    {% if product.auctionType is not same as("free_advertisment") %}
                        <hr>
                            <ul class="list-style-type-none pl-1">
                                <li><i class="material-icons icon-align">directions_car</i> Dostawa od {{ product.getCheapestDeliveryPrice() }} zł <br> <small>Czas wysyłki zwykle w ciągu {{ product.deliveryTime }} godzin</small></li>
                                <li class="mt-2"><i class="material-icons icon-align">remove_shopping_cart</i> 14 dni na odstąpienie od umowy</li>
                                {% if product.duration is not same as(null) and product.duration is not same as("0") %}
                                    {% if product.getTimeToTheEndOfAnAuction() is not same as(null) %}
                                        <li class="mt-2"><i class="material-icons icon-align">access_time</i> 
                                            Czas do końca aukcji: {{ product.getTimeToTheEndOfAnAuction().format('d') }} dni 
                                        </li>
                                    {% endif %}
                                {% endif %}
                            </ul>
                        <hr>

                        <small class="text-muted">Liczba sztuk</small> <br>

                        <div class="float-left">
                            <input type="number" value="1" min="1" max="{{ product.quantity }}" class="form-control mb-2" style="width: 100px" id="buying-items-quantity-input"> 
                        </div>
                        <div class="float-left">
                            <span class="text-muted col-5 ml-2">z {{ product.quantity }} sztuk</span>
                        </div>
                        <div style="clear:both"></div>

                        <form method="post" action="{{ path('basket_add_product', {'id': product.id}) }}">
                            <input type="hidden" name="_token" value="{{ csrf_token('basket_add_product' ~ product.id) }}">
                            <input type="hidden" name="items-quantity" id="add-to-basket-form" value="1">
                            <button type="submit" {{ product.owner == app.user ? 'disabled' }}  class="btn btn-danger no-border-radius width-100 mb-2">Dodaj do koszyka</button>
                        </form>

                        <form method="post" action="{{ path('purchase_summary', {'id' : product.id }) }}">
                            <input type="hidden" name="items-quantity" id="buy-now-form" value="1">
                            <button type="submit" {{ product.owner == app.user ? 'disabled' }} class="btn btn-danger no-border-radius width-100">Kup teraz</button>
                        </form>
                    {% else %}
                        <hr class="mb-1">
                        <div class="mb-2">
                            <small class="text-muted">21 dni do końca ogłoszenia</small>
                        </div>

                        <button type="button" disabled class="btn btn-danger no-border-radius width-100 opacity-100">{{ product.owner.email }}</button>
                        <button class="btn mt-2 no-border-radius width-100 bg-inherit link-button" data-toggle="modal" data-target="#ask-question-modal">Zadaj pytanie</button>

                        <div class="modal" tabindex="-1" id="ask-question-modal">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title text-center">Twoja wiadomość</h4>
                                        <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    {{ form_start(form) }}
                                    <div class="modal-body">
                                        {{ form_widget(form.text, {'attr': { 'class' : 'form-control' }}) }}
                                        <div class="error-msg form-error mt-1">
                                            {{ form_errors(form.text) }}
                                        </div>

                                        {% if app.user is same as(null) %}
                                            <div class="error-msg">
                                                Musisz być zalogowany żeby wysłać wiadomość.
                                            </div>
                                        {% elseif app.user is same as(product.owner) %}
                                            <div class="error-msg">
                                                Nie możesz wysłać wiadomości sam do siebie.
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Anuluj</button>
                                        <button type="submit" class="btn btn-primary" {{ app.user is same as(null) or app.user is same as(product.owner) ? 'disabled' : null }}>Wyślij</button>
                                    </div>
                                    {{ form_end(form) }}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="card card-body no-border-radius mt-3">
            <h4 class="mb-3">Parametry</h4>

            {% if product.getProductBasicProperties|length > 0 %}
                <h5 class="mb-3 mt-3">Parametry Fizyczne</h5>
                <div class="row">
                    {% for property in product.getProductBasicProperties %}
                    <div class="col-6">
                        {{ property.property }}: {{ property.value }}
                    </div>
                    {% endfor %} 
                </div>
            {% endif %}

            {% if product.getProductPhysicalProperties|length > 0 %}
                <h5 class="mb-3 mt-3">Parametry Fizyczne</h5>
                <div class="row">
                    {% for property in product.getProductPhysicalProperties %}
                    <div class="col-6">
                        {{ property.property }}: {{ property.value }}
                    </div>
                    {% endfor %} 
                </div>
            {% endif %}

            {% if product.getProductSpecificProperties|length > 0 %}
                <h5 class="mb-3 mt-3">Dane szczegółowe</h5>
                <div class="row">
                    {% for property in product.getProductSpecificProperties %}
                    <div class="col-6">
                        {{ property.property }}: {{ property.value }}
                    </div>
                    {% endfor %} 
                </div>
            {% endif %}
        </div>

        <div class="card card-body no-border-radius mt-3">
            <h4 class="mb-3">Opis</h4>
            <p>
                {{ product.description }}
            </p>
        </div>
    </div>
{% endblock %}